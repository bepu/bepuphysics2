<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Getting Started | Bepu Docs </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Getting Started | Bepu Docs ">
      
      
      <link rel="icon" href="favicon.ico">
      <link rel="stylesheet" href="public/docfx.min.css">
      <link rel="stylesheet" href="public/main.css">
      <meta name="docfx:navrel" content="toc.html">
      <meta name="docfx:tocrel" content="docs/toc.html">
      
      <meta name="docfx:rel" content="">
      
      
      <meta name="docfx:docurl" content="https://github.com/bepu/bepuphysics2/blob/master/Documentation/GettingStarted.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="index.html">
            <img id="logo" class="svg" src="images/bepuphysicslogo256.png" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="getting-started">Getting Started</h1>

<p>The best place to start is the demos in the <code>Demos.sln</code> solution. Jump into one in the <a 
        $match = $args[0]
        $originalLink = $args[0].Groups[1].Value
        # Remove the "../" prefix for the GitHub URL
        $relativePath = $originalLink -replace '^\.\.\/', ''
        "href=`"$repoUrl/$relativePath`""
    ><code>Demos/Demos/</code></a> folder and start playing around.</p>
<p>The <a 
        $match = $args[0]
        $originalLink = $args[0].Groups[1].Value
        # Remove the "../" prefix for the GitHub URL
        $relativePath = $originalLink -replace '^\.\.\/', ''
        "href=`"$repoUrl/$relativePath`""
    ><code>Demo</code></a> type is a very simple helper class that contains a few properties and functions used across all demos. It creates a <code>BufferPool</code> and <code>ThreadDispatcher</code> and provides a basic <code>Update</code> implementation that just calls <code>Simulation.Timestep</code> once with a fixed duration. A couple of alternative timestep examples are also provided in the comments.</p>
<p>Each <code>Demo</code> implementation creates its own <code>Simulation</code>. Some <code>Demo</code> types have extra input or rendering logic; input and rendering are fully separate from the actual physics library.</p>
<p>The <a 
        $match = $args[0]
        $originalLink = $args[0].Groups[1].Value
        # Remove the "../" prefix for the GitHub URL
        $relativePath = $originalLink -replace '^\.\.\/', ''
        "href=`"$repoUrl/$relativePath`""
    ><code>SimpleSelfContainedDemo</code></a> shows how to set up a simple simulation without relying on any of the Demos-provided infrastructure.</p>
<h2 id="building-a-simulation">Building a Simulation</h2>
<p><code>Simulation.Create</code> builds a <code>Simulation</code> instance, but has some unusual callback parameters- they take the form of interface-implementing structs.</p>
<p>The <code>TNarrowPhaseCallbacks</code> parameter handles collision-related callbacks, giving the user a way to control collision filtering, contact manifolds, materials, and a path to implementing things like collision events.</p>
<p><code>TPoseIntegratorCallbacks</code> provides control over per-body velocity integration behavior. It's typically used for implementing gravity or damping.</p>
<p>Examples:</p>
<ol>
<li><a 
        $match = $args[0]
        $originalLink = $args[0].Groups[1].Value
        # Remove the "../" prefix for the GitHub URL
        $relativePath = $originalLink -replace '^\.\.\/', ''
        "href=`"$repoUrl/$relativePath`""
    ><code>DemoCallbacks</code></a> shows the frequently used callbacks, including damping and unidirectional gravity and a basic passthrough <code>INarrowPhaseCallbacks</code>.</li>
<li><a 
        $match = $args[0]
        $originalLink = $args[0].Groups[1].Value
        # Remove the "../" prefix for the GitHub URL
        $relativePath = $originalLink -replace '^\.\.\/', ''
        "href=`"$repoUrl/$relativePath`""
    ><code>PlanetDemo</code></a> shows how to create a planet-like gravity source.</li>
<li><a 
        $match = $args[0]
        $originalLink = $args[0].Groups[1].Value
        # Remove the "../" prefix for the GitHub URL
        $relativePath = $originalLink -replace '^\.\.\/', ''
        "href=`"$repoUrl/$relativePath`""
    ><code>RagdollDemo</code></a> contains a slightly more advanced <code>INarrowPhaseCallbacks</code> collision filtering approach based on bitfields. Used to stop connected pieces of the ragdolls from colliding.</li>
<li><a 
        $match = $args[0]
        $originalLink = $args[0].Groups[1].Value
        # Remove the "../" prefix for the GitHub URL
        $relativePath = $originalLink -replace '^\.\.\/', ''
        "href=`"$repoUrl/$relativePath`""
    ><code>ContactEventsDemo</code></a> shows one possible way to collect contact data from the <code>INarrowPhaseCallbacks</code> and use it to generate contact events.</li>
</ol>
<p>Note that <code>TNarrowPhaseCallbacks</code> and <code>TPoseIntegratorCallbacks</code> are required to be structs and are provided with generic parameters rather than directly as interfaces. This is because the compiler has enough knowledge (and is forced) to avoid virtual dispatch and, when appropriate, inline the callbacks. Given that many of the callbacks are called with extremely high frequency, this can add up.</p>
<p>A similar pattern is used in many places across the engine. You can think about these as compile time delegates or closures, just with nastier syntax.</p>
<p><code>SolveDescription</code> describes how the simulation should schedule updates. You can set the number of velocity iterations and substeps that occur in each simulation timestep. For simulations with difficult constraint configurations, using more substeps can help stabilize the simulation far more cheaply than increasing velocity iterations can. For advanced use cases, you can schedule the number of velocity iterations for each substep individually.</p>
<p>There's also a fallback batch threshold, which you can safely leave at the default value almost always- it's the number of synchronized constraint batches that the simulation will create before falling back to a special case solve when individual bodies have excessive numbers of constraints connected to them.</p>
<p><code>Simulation.Create</code> also has a couple of optional parameters: initial allocation sizes to pull from the resource pool (to avoid unnecessary resizing later), and the <code>ITimestepper</code> which defines the order of stage execution within the engine.</p>
<p>The engine includes only one <code>ITimeStepper</code> type out of the box, which gets used if no other <code>ITimestepper</code> is provided: the <a 
        $match = $args[0]
        $originalLink = $args[0].Groups[1].Value
        # Remove the "../" prefix for the GitHub URL
        $relativePath = $originalLink -replace '^\.\.\/', ''
        "href=`"$repoUrl/$relativePath`""
    ><code>DefaultTimestepper</code></a>. It checks candidates for sleeping, computes bounding boxes, performs collision detection, solves constraints (which includes any necessary body velocity/pose integration), then does some incremental optimization work on internal data structures. There are callbacks between stages that can be hooked into. A custom <code>ITimestepper</code> could be provided that changes what stages execute or their order.</p>
<h2 id="timesteppingupdating">Timestepping/updating</h2>
<p><code>Simulation.Timestep</code> pushes the simulation forward by the given amount of time. If a <code>IThreadDispatcher</code> is provided, it is used to multithread the simulation.</p>
<p>The <code>Simulation</code> does not do anything fancy internally with temporal accumulation or anything else. Each <code>Timestep</code> simulates exactly the amount of time specified.</p>
<p>Examples of other timestepping strategies, like accumulating time and simulating as many timesteps of a fixed duration as necessary, are shown in <a 
        $match = $args[0]
        $originalLink = $args[0].Groups[1].Value
        # Remove the "../" prefix for the GitHub URL
        $relativePath = $originalLink -replace '^\.\.\/', ''
        "href=`"$repoUrl/$relativePath`""
    ><code>Demo.Update</code></a>.</p>
<p>It is recommended that the time step duration provided to <code>Simulation.Timestep</code> is always the same. Wildly varying timesteps can introduce instability. One-off changes or gradual changes can work well enough, but try to avoid jumping around constantly.</p>
<p>For varying timestep durations, <code>Solver.ScaleAccumulatedImpulses</code> can be used to scale the cached constraint solution by the ratio of the previous duration to the current duration. It's not free and it won't guarantee stability, but it can help.</p>
<h2 id="bodies">Bodies</h2>
<p>In v2, 'body' refers to a basic collidable mobile object that can be connected to constraints.</p>
<p>To create a body, pass a <code>BodyDescription</code> to <code>Simulation.Bodies.Add</code>. It returns a handle that uniquely identifies the body for as long as it belongs to the simulation. The <code>BodyDescription</code> specifies the initial pose, velocity, inertia, collidable, and activity state.</p>
<p>The <code>BodyDescription</code> type offers static factory functions for convenience.</p>
<p>Creating a body with zero inverse mass and inverse inertia will create a kinematic body, a body that will not change its velocity in response to any force. (<code>BodyDescription.CreateKinematic</code> only differs from <code>BodyDescription.CreateDynamic</code> in that it provides a zeroed out BodyInertia.) A dynamic body can be given a zeroed inverse inertia tensor to lock rotation only. Individual rows can also be zeroed out to lock rotation around the related local body axes.</p>
<p>The <code>CollidableDescription</code> takes a reference to a shape allocated in the <code>Simulation.Shapes</code> set. Shapes are allocated independently from bodies. Multiple bodies can refer to the same allocated shape. Collidables are also allowed to refer to no shape at all which can be useful for creating some constraint systems.</p>
<p>Note that there is no internal list of <code>BodyDescription</code> instances, nor a single &quot;Body&quot; type anywhere. Instead, body properties are split across different buffers depending on internal memory access patterns. Further, there are multiple <code>BodySet</code> instances, each with their own set of buffers. These buffers are set up for efficient internal access, with the first <code>BodySet</code> storing all active bodies and the later sets containing inactive body data. The <code>BodyDescription</code> is decomposed into these separate pieces upon being added.</p>
<p>To access an existing body's data, the body's current memory location must be looked up using the handle returned by the <code>Add</code> call. The <code>BodyReference</code> convenience type can make this a little easier by hiding the lookup process. You can get a <code>BodyReference</code> by indexing: <code>Simulation.Bodies[BodyHandle]</code>.</p>
<p>Bodies may move around in memory during execution or when other bodies are added, removed, awoken, or slept. Holding onto the raw memory location through one of these changes may result in the pointer pointing to undefined data. The <code>BodyReference</code> type performs lookups on demand, and remains valid so long as the wrapped <code>BodyHandle</code> does.</p>
<h2 id="statics">Statics</h2>
<p>Statics are similar to bodies but don't have velocity, inertia, or activity states. They're just immobile collidable shapes, ideal for level geometry.</p>
<p>Statics are computationally cheap. Feel free to have thousands of them.</p>
<p>To create a static object, pass a <code>StaticDescription</code> to <code>Simulation.Statics.Add</code>.</p>
<h2 id="constraints">Constraints</h2>
<p>Constraints can be used to control the relative motion of bodies. There are a <a 
        $match = $args[0]
        $originalLink = $args[0].Groups[1].Value
        # Remove the "../" prefix for the GitHub URL
        $relativePath = $originalLink -replace '^\.\.\/', ''
        "href=`"$repoUrl/$relativePath`""
    >whole bunch of them</a>. Like bodies and statics, constraints are created by building a description and passing it to <code>Simulation.Solver.Add</code>.</p>
<p>Some examples of constraints in the demos include:</p>
<ol>
<li><a 
        $match = $args[0]
        $originalLink = $args[0].Groups[1].Value
        # Remove the "../" prefix for the GitHub URL
        $relativePath = $originalLink -replace '^\.\.\/', ''
        "href=`"$repoUrl/$relativePath`""
    ><code>RagdollDemo</code></a> is a... demo of ragdolls.</li>
<li><a 
        $match = $args[0]
        $originalLink = $args[0].Groups[1].Value
        # Remove the "../" prefix for the GitHub URL
        $relativePath = $originalLink -replace '^\.\.\/', ''
        "href=`"$repoUrl/$relativePath`""
    ><code>CarDemo</code></a> shows how to build a simple constraint based car (and bad AI drivers).</li>
<li><a 
        $match = $args[0]
        $originalLink = $args[0].Groups[1].Value
        # Remove the "../" prefix for the GitHub URL
        $relativePath = $originalLink -replace '^\.\.\/', ''
        "href=`"$repoUrl/$relativePath`""
    ><code>RopeStabilityDemo</code></a> shows some constraint configuration failure modes and how to fix them.</li>
<li><a 
        $match = $args[0]
        $originalLink = $args[0].Groups[1].Value
        # Remove the "../" prefix for the GitHub URL
        $relativePath = $originalLink -replace '^\.\.\/', ''
        "href=`"$repoUrl/$relativePath`""
    ><code>NewtDemo</code></a> shows how to make a squishy newt.</li>
<li><a 
        $match = $args[0]
        $originalLink = $args[0].Groups[1].Value
        # Remove the "../" prefix for the GitHub URL
        $relativePath = $originalLink -replace '^\.\.\/', ''
        "href=`"$repoUrl/$relativePath`""
    ><code>ClothDemo</code></a> shows how to make sheets of cloth with different properties.</li>
</ol>
<p>Existing raw constraint data is more difficult to access than body data. There is a similar handle-&gt;memory location lookup, but the data itself is stored a few layers deep in array-of-structures-of-arrays format for performance. Pulling data out of this representation is not very convenient, so the <code>Solver</code> has <code>ApplyDescription</code> and <code>GetDescription</code> for accessing constraint data. Custom descriptions can be created to access only subsets of a constraint's full data.</p>
<h2 id="queries">Queries</h2>
<p>The engine supports scene-wide queries through <code>Simulation.RayCast</code> and <code>Simulation.Sweep</code>. Sweeps support both linear and angular motion for convex shapes. Both functions make use of hit handlers- <code>IRayHitHandler</code> and <code>ISweepHitHandler</code>. The handlers can filter out objects and respond to found impacts.</p>
<p>The <a 
        $match = $args[0]
        $originalLink = $args[0].Groups[1].Value
        # Remove the "../" prefix for the GitHub URL
        $relativePath = $originalLink -replace '^\.\.\/', ''
        "href=`"$repoUrl/$relativePath`""
    ><code>Grabber</code></a>, <a 
        $match = $args[0]
        $originalLink = $args[0].Groups[1].Value
        # Remove the "../" prefix for the GitHub URL
        $relativePath = $originalLink -replace '^\.\.\/', ''
        "href=`"$repoUrl/$relativePath`""
    ><code>RayCastingDemo</code></a> and <a 
        $match = $args[0]
        $originalLink = $args[0].Groups[1].Value
        # Remove the "../" prefix for the GitHub URL
        $relativePath = $originalLink -replace '^\.\.\/', ''
        "href=`"$repoUrl/$relativePath`""
    ><code>SweepDemo</code></a> have some examples of these queries, plus some other more advanced cases.</p>
<p>The broad phase acceleration structures can be <a 
        $match = $args[0]
        $originalLink = $args[0].Groups[1].Value
        # Remove the "../" prefix for the GitHub URL
        $relativePath = $originalLink -replace '^\.\.\/', ''
        "href=`"$repoUrl/$relativePath`""
    >directly queried</a> by ray casts, bounding boxes, and swept bounding boxes.</p>
<h2 id="memory">Memory</h2>
<p>Almost all of the internally used memory is pulled from a custom allocator working with pinned memory. Almost all stages have some form of memory management API for preallocating, compacting, or disposing resources.</p>
<p>The <code>Simulation</code> has a few top-level functions to help orchestrate all the different stage allocations, including <code>Clear</code>, <code>EnsureCapacity</code>, <code>Resize</code>, and <code>Dispose</code>. Most use cases get by with the default initial allocation sizes and then Disposing upon completion.</p>
<p>Notably, the <code>Simulation</code> does not have its own allocator. It relies on <code>BufferPool</code> instances provided by the user. All of the resource management APIs on the <code>Simulation</code> and its stages operate on these pools. In other words, if you're okay with just clearing the <code>BufferPool</code> instances that a simulation relies on and letting the GC pick up the pieces, you don't technically have to <code>Clear</code> or <code>Dispose</code> the <code>Simulation</code> itself. (Of course, that <code>Simulation</code> instance should not be used after it has had the rug pulled out from under it.)</p>
<p>Failure to return resources to a <code>BufferPool</code> or to clear an unused <code>BufferPool</code> can cause memory leaks.</p>
<h2 id="asserts-and-debugging">Asserts and debugging</h2>
<p>Many invalid inputs and error states are left unchecked in release mode. Most error checking is performed using <code>Debug.Assert</code>, requiring compilation with the <code>DEBUG</code> symbol. Including <code>CHECKMATH</code> (as the <code>Debug</code> configuration does by default) is also helpful for tracking down NaN-explosions sometimes.</p>
<p>The <code>LEAKDEBUG</code> symbol can be added to help track down <code>BufferPool</code> related memory leaks. It is extremely expensive, but adds deep diagnostics for every allocation.</p>
<h2 id="a-note-on-design-intent">A note on design intent</h2>
<p>As the above suggests, the engine uses a lot of idioms which are historically uncommon in C#. There are value types and refs everywhere, SIMD out the wazoo, object data is split and packed into performance-optimized storage formats, APIs directly expose the underlying data, language features are abused for metaprogramming, and the engine generally lets you break stuff.</p>
<p>In summary, it's a very low level API. The intent is to maximize performance, then expose as much as possible to let application-specific convenient abstractions be built on top.</p>
<p>All of this puts a heavier burden on users. They must be familiar with value type semantics, new performance minded language features, pointers, and all sorts of other unusual-for-C# stuff. If you've got questions, feel free to post them in the <a href="https://github.com/bepu/bepuphysics2/discussions">discussions</a>.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/bepu/bepuphysics2/blob/master/Documentation/GettingStarted.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>

